{
    "info": {
        "_postman_id": "auth-service-collection",
        "name": "Auth Service API - Complete",
        "description": "Complete authentication service API with JWT token management, user management, tenant management, and JWKS endpoints.",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "Health & Info",
            "item": [
                {
                    "name": "Root Endpoint",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/",
                            "host": ["{{base_url}}"],
                            "path": [""]
                        },
                        "description": "Welcome message from the auth service"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "Authentication",
            "item": [
                {
                    "name": "Register User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 201) {",
                                    "    pm.test('Registration successful', function() {",
                                    "        pm.response.to.have.status(201);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response has user id', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "        pm.environment.set('user_id', jsonData.id);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Cookies are set', function() {",
                                    "        pm.expect(pm.cookies.has('accessToken')).to.be.true;",
                                    "        pm.expect(pm.cookies.has('refreshToken')).to.be.true;",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\",\n    \"email\": \"{{test_email}}\",\n    \"password\": \"{{test_password}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/register",
                            "host": ["{{base_url}}"],
                            "path": ["auth", "register"]
                        },
                        "description": "Register a new user account.\n\n**Requirements:**\n- Email must be unique and valid format\n- Password minimum 8 characters with uppercase, lowercase, number, and special character\n- All fields are required\n\n**Response:**\n- Sets httpOnly cookies: accessToken (1h) and refreshToken (1y)\n- Returns user ID"
                    },
                    "response": []
                },
                {
                    "name": "Login",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.test('Login successful', function() {",
                                    "        pm.response.to.have.status(200);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response has user id', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "        pm.environment.set('user_id', jsonData.id);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Cookies are set', function() {",
                                    "        pm.expect(pm.cookies.has('accessToken')).to.be.true;",
                                    "        pm.expect(pm.cookies.has('refreshToken')).to.be.true;",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"email\": \"{{test_email}}\",\n    \"password\": \"{{test_password}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/auth/login",
                            "host": ["{{base_url}}"],
                            "path": ["auth", "login"]
                        },
                        "description": "Login with email and password.\n\n**Rate Limiting:**\n- Maximum 5 failed attempts per 15 minutes per IP\n\n**Response:**\n- Sets httpOnly cookies: accessToken (1h) and refreshToken (1y)\n- Returns user ID"
                    },
                    "response": []
                },
                {
                    "name": "Get Current User",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/auth/self",
                            "host": ["{{base_url}}"],
                            "path": ["auth", "self"]
                        },
                        "description": "Get current authenticated user information.\n\n**Requires:** Valid access token in cookies\n\n**Returns:** User profile without password"
                    },
                    "response": []
                },
                {
                    "name": "Refresh Token",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/auth/refresh",
                            "host": ["{{base_url}}"],
                            "path": ["auth", "refresh"]
                        },
                        "description": "Refresh access token using refresh token from cookies.\n\n**Token Rotation:**\n- Old refresh token deleted\n- New tokens issued\n- Both set as httpOnly cookies"
                    },
                    "response": []
                },
                {
                    "name": "Logout",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/auth/logout",
                            "host": ["{{base_url}}"],
                            "path": ["auth", "logout"]
                        },
                        "description": "Logout and revoke refresh token.\n\n**Actions:**\n- Deletes refresh token from database\n- Clears cookies"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "User Management",
            "item": [
                {
                    "name": "Get All Users",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.test('Users list retrieved', function() {",
                                    "        pm.response.to.have.status(200);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response is an array', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.be.an('array');",
                                    "    });",
                                    "    ",
                                    "    if (pm.response.json().length > 0) {",
                                    "        pm.test('User has required fields', function() {",
                                    "            var user = pm.response.json()[0];",
                                    "            pm.expect(user).to.have.property('id');",
                                    "            pm.expect(user).to.have.property('email');",
                                    "            pm.expect(user).to.not.have.property('password');",
                                    "        });",
                                    "    }",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/users?page={{page}}&limit={{limit}}",
                            "host": ["{{base_url}}"],
                            "path": ["users"],
                            "query": [
                                {
                                    "key": "page",
                                    "value": "{{page}}"
                                },
                                {
                                    "key": "limit",
                                    "value": "{{limit}}"
                                }
                            ]
                        },
                        "description": "Get all users with pagination.\n\n**Requires:** Admin role\n\n**Query Parameters:**\n- page: Page number (default: 1)\n- limit: Items per page (default: 10)\n\n**Response:** Array of users with tenant info"
                    },
                    "response": []
                },
                {
                    "name": "Get User by ID",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.test('User retrieved successfully', function() {",
                                    "        pm.response.to.have.status(200);",
                                    "    });",
                                    "    ",
                                    "    pm.test('User has required fields', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "        pm.expect(jsonData).to.have.property('email');",
                                    "        pm.expect(jsonData).to.have.property('role');",
                                    "        pm.expect(jsonData).to.not.have.property('password');",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/users/{{user_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["users", "{{user_id}}"]
                        },
                        "description": "Get a specific user by ID.\n\n**Requires:** Admin role\n\n**Returns:** User details with tenant information"
                    },
                    "response": []
                },
                {
                    "name": "Create Manager",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 201) {",
                                    "    pm.test('Manager created successfully', function() {",
                                    "        pm.response.to.have.status(201);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response has manager id', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "        pm.environment.set('manager_id', jsonData.id);",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"firstName\": \"Manager\",\n    \"lastName\": \"Smith\",\n    \"email\": \"{{manager_email}}\",\n    \"password\": \"{{manager_password}}\",\n    \"tenantId\": {{tenant_id}}\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/users",
                            "host": ["{{base_url}}"],
                            "path": ["users"]
                        },
                        "description": "Create a new manager user.\n\n**Requires:** Admin role\n\n**Required Fields:**\n- firstName\n- lastName\n- email (must be unique)\n- password (strong password)\n- tenantId (must exist)\n\n**Response:** Returns created manager ID"
                    },
                    "response": []
                },
                {
                    "name": "Update User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.test('User updated successfully', function() {",
                                    "        pm.response.to.have.status(200);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response has user id', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"firstName\": \"Updated\",\n    \"lastName\": \"Name\",\n    \"role\": \"manager\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/users/{{user_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["users", "{{user_id}}"]
                        },
                        "description": "Update user information.\n\n**Requires:** Admin role\n\n**Updatable Fields:**\n- firstName\n- lastName\n- role (customer, manager, admin)\n\n**Note:** Email and password cannot be updated via this endpoint"
                    },
                    "response": []
                },
                {
                    "name": "Delete User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.test('User deleted successfully', function() {",
                                    "        pm.response.to.have.status(200);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response has user id', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "DELETE",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/users/{{user_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["users", "{{user_id}}"]
                        },
                        "description": "Delete a user.\n\n**Requires:** Admin role\n\n**Response:** Returns deleted user ID"
                    },
                    "response": []
                }
            ],
            "description": "User management endpoints for admins.\n\n**All endpoints require Admin role**"
        },
        {
            "name": "Tenant Management",
            "item": [
                {
                    "name": "Get All Tenants",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.test('Tenants list retrieved', function() {",
                                    "        pm.response.to.have.status(200);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response is an array', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.be.an('array');",
                                    "    });",
                                    "    ",
                                    "    if (pm.response.json().length > 0) {",
                                    "        pm.test('Tenant has required fields', function() {",
                                    "            var tenant = pm.response.json()[0];",
                                    "            pm.expect(tenant).to.have.property('id');",
                                    "            pm.expect(tenant).to.have.property('name');",
                                    "            pm.expect(tenant).to.have.property('address');",
                                    "        });",
                                    "    }",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/tenants?page={{page}}&limit={{limit}}",
                            "host": ["{{base_url}}"],
                            "path": ["tenants"],
                            "query": [
                                {
                                    "key": "page",
                                    "value": "{{page}}"
                                },
                                {
                                    "key": "limit",
                                    "value": "{{limit}}"
                                }
                            ]
                        },
                        "description": "Get all tenants with pagination.\n\n**Requires:** Admin role\n\n**Query Parameters:**\n- page: Page number (default: 1)\n- limit: Items per page (default: 10)\n\n**Response:** Array of tenants"
                    },
                    "response": []
                },
                {
                    "name": "Get Tenant by ID",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.test('Tenant retrieved successfully', function() {",
                                    "        pm.response.to.have.status(200);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Tenant has required fields', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "        pm.expect(jsonData).to.have.property('name');",
                                    "        pm.expect(jsonData).to.have.property('address');",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/tenants/{{tenant_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["tenants", "{{tenant_id}}"]
                        },
                        "description": "Get a specific tenant by ID.\n\n**Requires:** Admin role\n\n**Returns:** Tenant details"
                    },
                    "response": []
                },
                {
                    "name": "Create Tenant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 201) {",
                                    "    pm.test('Tenant created successfully', function() {",
                                    "        pm.response.to.have.status(201);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response has tenant id', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "        pm.environment.set('tenant_id', jsonData.id);",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"{{tenant_name}}\",\n    \"address\": \"{{tenant_address}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/tenants",
                            "host": ["{{base_url}}"],
                            "path": ["tenants"]
                        },
                        "description": "Create a new tenant.\n\n**Requires:** Admin role\n\n**Required Fields:**\n- name (2-100 characters)\n- address\n\n**Response:** Returns created tenant ID"
                    },
                    "response": []
                },
                {
                    "name": "Update Tenant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.test('Tenant updated successfully', function() {",
                                    "        pm.response.to.have.status(200);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response has tenant id', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "PATCH",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"name\": \"Updated Tenant Name\",\n    \"address\": \"123 New Street, City, Country\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/tenants/{{tenant_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["tenants", "{{tenant_id}}"]
                        },
                        "description": "Update tenant information.\n\n**Requires:** Admin role\n\n**Updatable Fields:**\n- name\n- address\n\n**Response:** Returns updated tenant ID"
                    },
                    "response": []
                },
                {
                    "name": "Delete Tenant",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "if (pm.response.code === 200) {",
                                    "    pm.test('Tenant deleted successfully', function() {",
                                    "        pm.response.to.have.status(200);",
                                    "    });",
                                    "    ",
                                    "    pm.test('Response has tenant id', function() {",
                                    "        var jsonData = pm.response.json();",
                                    "        pm.expect(jsonData).to.have.property('id');",
                                    "    });",
                                    "}"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "DELETE",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/tenants/{{tenant_id}}",
                            "host": ["{{base_url}}"],
                            "path": ["tenants", "{{tenant_id}}"]
                        },
                        "description": "Delete a tenant.\n\n**Requires:** Admin role\n\n**Note:** This will also affect all users associated with this tenant\n\n**Response:** Returns deleted tenant ID"
                    },
                    "response": []
                }
            ],
            "description": "Tenant management endpoints for admins.\n\n**All endpoints require Admin role**"
        },
        {
            "name": "JWKS & Security",
            "item": [
                {
                    "name": "Get JWKS (Public Keys)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "pm.test('JWKS endpoint returns 200', function() {",
                                    "    pm.response.to.have.status(200);",
                                    "});",
                                    "",
                                    "pm.test('Response is valid JSON', function() {",
                                    "    pm.response.to.be.json;",
                                    "});",
                                    "",
                                    "pm.test('JWKS has keys array', function() {",
                                    "    var jsonData = pm.response.json();",
                                    "    pm.expect(jsonData).to.have.property('keys');",
                                    "    pm.expect(jsonData.keys).to.be.an('array');",
                                    "    pm.expect(jsonData.keys.length).to.be.above(0);",
                                    "});",
                                    "",
                                    "pm.test('Public key has required fields', function() {",
                                    "    var jsonData = pm.response.json();",
                                    "    var key = jsonData.keys[0];",
                                    "    pm.expect(key).to.have.property('kty', 'RSA');",
                                    "    pm.expect(key).to.have.property('use', 'sig');",
                                    "    pm.expect(key).to.have.property('alg', 'RS256');",
                                    "    pm.expect(key).to.have.property('kid');",
                                    "    pm.expect(key).to.have.property('n');",
                                    "    pm.expect(key).to.have.property('e');",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/.well-known/jwks.json",
                            "host": ["{{base_url}}"],
                            "path": [".well-known", "jwks.json"]
                        },
                        "description": "Get JSON Web Key Set (JWKS) for JWT verification.\n\n**Public Endpoint** - No authentication required\n\n**Use Cases:**\n- Verify JWT signatures in other services\n- Third-party integrations\n\n**Response:** Contains RSA public keys"
                    },
                    "response": []
                }
            ],
            "description": "JWKS endpoints for token verification"
        }
    ],
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:5501",
            "type": "string"
        }
    ]
}
